<?xml version = "1.0" encoding = "UTF-8" ?>
<!--
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
  Oracle JDeveloper BPEL Designer 
  
  Created: Thu Dec 05 18:56:40 IST 2013
  Author:  RS0086274
  Type: BPEL 1.1 Process
  Purpose: Synchronous BPEL Process
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
-->
<process name="ProcessPaymentEBF"
         targetNamespace="http://xmlns.oracle.com/Autopayment/ProcessPaymentEBF/ProcessPaymentEBF"
         xmlns="http://schemas.xmlsoap.org/ws/2003/03/business-process/"
         xmlns:client="http://xmlns.oracle.com/Autopayment/ProcessPaymentEBF/ProcessPaymentEBF"
         xmlns:ora="http://schemas.oracle.com/xpath/extension"
         xmlns:bpelx="http://schemas.oracle.com/bpel/extension"
         xmlns:aiaerrorws="http://xmlns.oracle.com/AIAAsyncErrorHandlingBPELProcess"
         xmlns:bpws="http://schemas.xmlsoap.org/ws/2003/03/business-process/"
         xmlns:ns1="http://xmlns.oracle.com/VFQAFL/PaymentCollectionDDGenericProvABCSImpl/PaymentCollectionDDGenericProvABCSImpl"
         xmlns:ns2="http://xmlns.oracle.com/VFQAFL/PaymentProcessingMIGSProvABCSImpl/PaymentProcessingMIGSProvABCSImpl"
         xmlns:bpel2="http://docs.oasis-open.org/wsbpel/2.0/process/executable"
         xmlns:xp20="http://www.oracle.com/XSL/Transform/java/oracle.tip.pc.services.functions.Xpath20"
         xmlns:oraext="http://www.oracle.com/XSL/Transform/java/oracle.tip.pc.services.functions.ExtFunc"
         xmlns:dvm="http://www.oracle.com/XSL/Transform/java/oracle.tip.dvm.LookupValue"
         xmlns:hwf="http://xmlns.oracle.com/bpel/workflow/xpath"
         xmlns:ids="http://xmlns.oracle.com/bpel/services/IdentityService/xpath"
         xmlns:bpm="http://xmlns.oracle.com/bpmn20/extensions"
         xmlns:xdk="http://schemas.oracle.com/bpel/extension/xpath/function/xdk"
         xmlns:xref="http://www.oracle.com/XSL/Transform/java/oracle.tip.xref.xpath.XRefXPathFunctions"
         xmlns:ldap="http://schemas.oracle.com/xpath/extension/ldap"
         xmlns:ns5="http://schemas.xmlsoap.org/ws/2003/03/addressing"
         xmlns:ns8="http://xmlns.oracle.com/EnterpriseObjects/Core/Custom/EBO/ReceivedPayment/V1"
         xmlns:ns3="http://xmlns.oracle.com/EnterpriseObjects/Core/EBO/ReceivedPayment/V1"
         xmlns:ns4="http://xmlns.oracle.com/EnterpriseObjects/Core/Common/V2"
         xmlns:ns6="http://xmlns.oracle.com/EnterpriseObjects/Core/Custom/Common/V2"
         xmlns:ns7="urn:oasis:names:tc:xacml:2.0:context:schema:cd:04"
         xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
         xmlns:ns9="http://xmlns.oracle.com/vfq/p1/paymentgeneric"
         xmlns:ns10="http://xmlns.oracle.com/Dev/ProcessDirectDebitPortalReqABCSImpl/ProcessDirectDebitPortalReqABCSImpl"
         xmlns:ns11="http://xmlns.oracle.com/VFQA_FL_Offshore/PaymentCollectionDDSiebelReqABCSImpl/PaymentCollectionDDSiebelReqABCSImpl"
         xmlns:xsd="http://www.w3.org/2001/XMLSchema"
         xmlns:ns12="http://xmlns.oracle.com/vfq/p1/AsapOrder"
         xmlns:ns13="http://www.vf.com/VFQA"
         xmlns:ns14="http://xmlns.oracle.com/ABCSImpl/BRM/Industry/Comms/CreateReceivedPaymentBRMCommsProvABCSImpl/V1"
         xmlns:ns15="http://xmlns.oracle.com/Autopayment/UpdatePaymentReceiptVFQABCS/UpdatePaymentReceiptVFQABCS"
         xmlns:aia="http://www.oracle.com/XSL/Transform/java/oracle.apps.aia.core.xpath.AIAFunctions"
         xmlns:ns16="http://xmlns.oracle.com/ABCSImpl/Asap/Industry/Telco/ProcessAccountBalanceAdjustmentAsapProvABCSImpl/V1"
         xmlns:nsadj="http://xmlns.oracle.com/EnterpriseObjects/Core/EBO/AccountBalanceAdjustment/V2">
  <!-- 
      ////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
        PARTNERLINKS                                                      
        List of services participating in this BPEL process               
      ////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
    -->
  <partnerLinks>
    <!-- 
      The 'client' role represents the requester of this service. It is 
      used for callback. The location and correlation information associated
      with the client role are automatically set using WS-Addressing.
    -->
    <partnerLink name="processpaymentebf_client"
                 partnerLinkType="client:ProcessPaymentEBF"
                 myRole="ProcessPaymentEBFProvider"/>
    <partnerLink name="ProcessMigsProv"
                 partnerLinkType="ns2:PaymentProcessingMIGSProvABCSImpl"
                 partnerRole="PaymentProcessingMIGSProvABCSImplProvider"/>
    <partnerLink name="GenericDDBankPayments"
                 partnerLinkType="ns11:PaymentCollectionDDSiebelReqABCSImpl"
                 partnerRole="PaymentCollectionDDSiebelReqABCSImplProvider"/>
    <!--partnerLink name="ASAPOrder_Input" partnerLinkType="ns12:AsapOrder"
                 myRole="AsapOrderRequester" partnerRole="AsapOrderProvider"/-->
    <partnerLink name="CreateReceivedPaymentBRMProv_Plink"
                 partnerLinkType="ns14:CreateReceivedPaymentBRMCommsProvABCSImpl"
                 partnerRole="CreateReceivedPaymentBRMCommsProvABCSImplProvider"/>
    <partnerLink name="UpdatePaymentReceiptEBS"
                 partnerLinkType="ns15:UpdatePaymentReceiptEBS"
                 partnerRole="execute_ptt"/>
    <partnerLink name="UpdatePaymentReceipt"
                 partnerLinkType="ns15:UpdatePaymentReceiptEBS"
                 partnerRole="execute_ptt"/>
    <partnerLink name="AIAAsyncErrorHandlingBPELProcess1"
                 partnerLinkType="aiaerrorws:AIAAsyncErrorHandlingBPELProcess"
                 partnerRole="AIAAsyncErrorHandlingBPELProcessProvider"/>
    <partnerLink name="ProcessAccountBalanceAdjustmentAsapProvABCSImpl"
                 partnerLinkType="ns16:ProcessAccountBalanceAdjustmentAsapProvABCSImpl"
                 partnerRole="ProcessAccountBalanceAdjustmentAsapProvABCSImplProvider"
                 myRole="ProcessAccountBalanceAdjustmentAsapProvABCSImplRequestor"/>
  </partnerLinks>
  <!-- 
    ////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
      VARIABLES                                                        
      List of messages and XML documents used within this BPEL process 
    ////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
  -->
  <variables>
    <!-- Reference to the message passed as input during initiation -->
    <variable name="inputVariable"
              messageType="client:ProcessPaymentEBFRequestMessage"/>
    <!-- Reference to the message that will be returned to the requester-->
    <variable name="outputVariable"
              messageType="client:ProcessPaymentEBFResponseMessage"/>
    <variable name="EnterpriseFaultMsg" messageType="client:FaultMsg"
              xml:id="id_28"/>
    <variable name="FaultVar" messageType="client:FaultMsg"/>
		<variable name="Title" type="xsd:string"/>
    <variable name="Invoke_MIGS_process_InputVariable"
              messageType="ns2:PaymentProcessingMIGSProvABCSImplRequestMessage"/>
    <variable name="Invoke_MIGS_process_OutputVariable"
              messageType="ns2:PaymentProcessingMIGSProvABCSImplResponseMessage"/>
    <variable name="Invoke_GenericDDBankPayments_process_InputVariable"
              messageType="ns11:PaymentCollectionDDSiebelReqABCSImplRequestMessage"/>
    <variable name="Invoke_GenericDDBankPayments_process_OutputVariable"
              messageType="ns11:PaymentCollectionDDSiebelReqABCSImplResponseMessage"/>
    <variable name="Status" type="xsd:string"/><variable name="IncomingPaymentStatus" type="xsd:string"/><variable name="AutoPaymentStatus" type="xsd:string"/>
    <!--variable name="Invoke_ASAP_Order_initiate_InputVariable"
              messageType="ns12:AsapOrderRequestMessage"/-->
    <!--variable name="ReceiveASAP_Response_onResult_InputVariable"
              messageType="ns12:AsapOrderResponseMessage"/-->
    <!--variable name="Receive1_onResult_InputVariable"
              messageType="ns12:AsapOrderResponseMessage"/-->
    <variable name="Invoke_AIAEH_initiate_InputVariable"
              messageType="aiaerrorws:AIAAsyncErrorHandlingBPELProcessRequestMessage"
              xml:id="id_79"/>
    <variable name="Invoke_BRM_CreateReceivedPaymentRequestResponse_InputVariable"
              messageType="ns14:CreateReceivedPaymentReqMsg"/>
    <variable name="Invoke_BRM_CreateReceivedPaymentRequestResponse_OutputVariable"
              messageType="ns14:CreateReceivedPaymentRespMsg"/>
    <variable name="SystemFaultMessage"
              messageType="bpelx:RuntimeFaultMessage"/>
    <variable name="Invoke_UpadatePaymentStatus_execute_InputVariable"
              messageType="ns15:requestMessage"/>
    <variable name="InvokeBRM_Fault_Update_execute_InputVariable"
              messageType="ns15:requestMessage"/>
    <variable name="AIAAsyncErrorHandling_Input"
              messageType="aiaerrorws:AIAAsyncErrorHandlingBPELProcessRequestMessage"/>
    <variable name="AIAAsyncErrorHandling_Input1"
              messageType="aiaerrorws:AIAAsyncErrorHandlingBPELProcessRequestMessage"/>
    <variable messageType="ns14:CreateReceivedPaymentFaultMsg"
              name="BRMFaultVar"/>
    <variable name="Errorhandler13_execute_InputVariable"
              messageType="ns15:requestMessage"/>
    <variable name="InvokeAsapProvInVar"
              messageType="ns16:CreateAccountBalanceAdjustmentListReqMsg"/>
    <variable name="OnResultAsapProvOutVar"
              messageType="ns16:CreateAccountBalanceAdjustmentListResMsg"/>
  </variables>
  <faultHandlers>
    <catch faultName="bpelx:remoteFault" faultVariable="SystemFaultMessage">
      <sequence name="Sequence5">
        <assign name="CreateEnterpriseFaultMsg">
          <copy>
            <from expression="ora:processXSLT('xsl/EBM_to_Fault_1.xsl',bpws:getVariableData('inputVariable','payload'))"/>
            <to variable="AIAAsyncErrorHandling_Input1" part="FaultMessage"
                query="/ns4:Fault"/>
          </copy>
          <copy>
            <from variable="SystemFaultMessage" part="code"/>
            <to variable="AIAAsyncErrorHandling_Input1" part="FaultMessage"
                query="/ns4:Fault/ns4:FaultNotification/ns4:FaultMessage/ns4:Code"/>
          </copy>
          <copy>
            <from variable="SystemFaultMessage" part="summary"/>
            <to variable="AIAAsyncErrorHandling_Input1" part="FaultMessage"
                query="/ns4:Fault/ns4:FaultNotification/ns4:FaultMessage/ns4:Text"/>
          </copy>
          <!--    Description Populate Start   -->
          <copy bpelx:ignoreMissingFromData="yes">
            <from expression="concat('BRM',':',bpws:getVariableData('inputVariable','payload','/ns3:CreateReceivedPaymentEBM/ns3:DataArea/ns3:CreateReceivedPayment/ns3:PaymentMethodCode'),':',bpws:getVariableData('inputVariable','payload','/ns3:CreateReceivedPaymentEBM/ns3:DataArea/ns3:CreateReceivedPayment/ns4:BankPayment/ns4:Identification/ns4:ID'),':',bpws:getVariableData('FaultVar','AIAFault','/ns4:Fault/ns4:FaultNotification/ns4:FaultMessage/ns4:Text'),bpws:getVariableData('SystemFaultMessage','summary'))"/>
            <to variable="AIAAsyncErrorHandling_Input1" part="FaultMessage"
                query="/ns4:Fault/ns4:FaultNotification/ns4:FaultMessage/ns4:Text"/>
          </copy>
          <!--	Description Populate	-->
          <copy>
            <from variable="SystemFaultMessage" part="detail"/>
            <to variable="AIAAsyncErrorHandling_Input1" part="FaultMessage"
                query="/ns4:Fault/ns4:FaultNotification/ns4:FaultMessage/ns4:Stack"/>
          </copy>
          <!--copy bpelx:ignoreMissingFromData="yes" bpelx:ignoreMissingToData="yes">
            <from expression="'AutoPayment Failure'"/>
            <to variable="AIAAsyncErrorHandling_Input1" part="FaultMessage"
                query="/ns4:Fault/ns4:EBMReference/ns4:BusinessScopeReference/ns4:InstanceID"/>
          </copy-->
          <copy bpelx:ignoreMissingFromData="yes">
            <from expression="xp20:current-dateTime()"/>
            <to variable="AIAAsyncErrorHandling_Input1" part="FaultMessage"
                query="/ns4:Fault/ns4:FaultNotification/ns4:ReportingDateTime"/>
          </copy>
          <copy bpelx:ignoreMissingFromData="yes">
            <from expression="ora:getCompositeName()"/>
            <to variable="AIAAsyncErrorHandling_Input1" part="FaultMessage"
                query="/ns4:Fault/ns4:FaultNotification/ns4:FaultingService/ns4:ID"/>
          </copy>
          <copy bpelx:ignoreMissingFromData="yes">
            <from expression="'BPEL'"/>
            <to variable="AIAAsyncErrorHandling_Input1" part="FaultMessage"
                query="/ns4:Fault/ns4:FaultNotification/ns4:FaultingService/ns4:ImplementationCode"/>
          </copy>
          <copy bpelx:ignoreMissingFromData="yes">
            <from expression="ora:getCompositeInstanceId()"/>
            <to variable="AIAAsyncErrorHandling_Input1" part="FaultMessage"
                query="/ns4:Fault/ns4:FaultNotification/ns4:FaultingService/ns4:InstanceID"/>
          </copy>
		  <!-- Added by Ravi for TT creation in accounts Tab in SIEBEL Defect SIT2 : 8305 >
		   <copy bpelx:insertMissingToData="yes">
            <from variable="inputVariable" part="payload"
                  query="/ns3:CreateReceivedPaymentEBM/ns3:DataArea/ns3:CreateReceivedPayment/ns4:PayFromPartyReference/ns4:CustomerPartyAccountIdentification/ns4:BusinessComponentID"/>
            <to variable="AIAAsyncErrorHandling_Input1" part="FaultMessage"
                query="/ns4:Fault/ns4:EBMReference/ns4:SenderReference/ns4:ObjectCrossReference/ns4:SenderObjectIdentification/ns4:AlternateObjectKey/ns4:ID"/>
          </copy>
          <copy bpelx:insertMissingToData="yes">
            <from expression="'SEBL_01'"/>
            <to variable="AIAAsyncErrorHandling_Input1" part="FaultMessage"
                query="/ns4:Fault/ns4:EBMReference/ns4:SenderReference/ns4:ObjectCrossReference/ns4:SenderObjectIdentification/ns4:AlternateObjectKey/ns4:ID/@schemeAgencyID"/>
          </copy>
          <copy bpelx:insertMissingToData="yes">
            <from expression="xref:lookupXRef(&quot;oramds:/apps/AIAMetaData/xref/CUSTOMERPARTY_ACCOUNTID.xref&quot;,&quot;COMMON&quot;,bpws:getVariableData('inputVariable','payload','/ns3:CreateReceivedPaymentEBM/ns3:DataArea/ns3:CreateReceivedPayment/ns4:PayFromPartyReference/ns4:CustomerPartyAccountIdentification/ns4:BusinessComponentID'),&quot;SEBL_01&quot;,true())"/>
            <to variable="AIAAsyncErrorHandling_Input1" part="FaultMessage"
                query="/ns4:Fault/ns4:EBMReference/ns4:SenderReference/ns4:ObjectCrossReference/ns4:SenderObjectIdentification/ns4:AlternateObjectKey/ns4:ID"/>
          </copy>
		  < END -->
        </assign>
        <invoke name="ErrorHandler1"
                inputVariable="AIAAsyncErrorHandling_Input1"
                partnerLink="AIAAsyncErrorHandlingBPELProcess1"
                portType="aiaerrorws:AIAAsyncErrorHandlingBPELProcess"
                operation="initiate" bpelx:invokeAsDetail="no"/>
        <assign name="Assign_BRMPaymentPosting_Remote_Fault_Update"> 
         <copy bpelx:insertMissingToData="yes">
                            <from expression="'BRM_Failure'"/>
                            <to variable="AutoPaymentStatus"/>
                          </copy>
          <copy bpelx:ignoreMissingFromData="yes">
            <from variable="inputVariable" part="payload"
                  query="/ns3:CreateReceivedPaymentEBM/ns3:DataArea/ns3:CreateReceivedPayment/ns3:Custom/ns8:PaymentId"/>
            <to variable="Invoke_UpadatePaymentStatus_execute_InputVariable"
                part="request"
                query="/ns3:CreateReceivedPaymentResponseEBM/ns3:DataArea/ns3:CreateReceivedPaymentResponse/ns3:Custom/ns8:PaymentId"/>
          </copy><copy bpelx:ignoreMissingFromData="yes">
            <from variable="outputVariable" part="payload"
                  query="/ns3:QueryReceivedPaymentListResponseEBM/ns3:DataArea/ns3:QueryReceivedPaymentListResponse/ns3:Custom/ns8:ReasonForRequest"/>
            <to variable="Invoke_UpadatePaymentStatus_execute_InputVariable"
                part="request"
                query="/ns3:CreateReceivedPaymentResponseEBM/ns3:DataArea/ns3:CreateReceivedPaymentResponse/ns3:Custom/ns8:Type"/>
          </copy><copy>
            <from variable="Status"/>
            <to variable="Invoke_UpadatePaymentStatus_execute_InputVariable"
                part="request"
                query="/ns3:CreateReceivedPaymentResponseEBM/ns3:DataArea/ns3:CreateReceivedPaymentResponse/ns3:Custom/ns8:StepNumber"/>
          </copy>
          <copy bpelx:ignoreMissingFromData="yes">
            <from variable="outputVariable" part="payload"
                  query="/ns3:QueryReceivedPaymentListResponseEBM/ns4:EBMHeader"/>
            <to variable="Invoke_UpadatePaymentStatus_execute_InputVariable"
                part="request"
                query="/ns3:CreateReceivedPaymentResponseEBM/ns4:EBMHeader"/>
          </copy>
          <copy bpelx:ignoreMissingFromData="yes">
            <from expression="xref:lookupXRef(&quot;oramds:/apps/AIAMetaData/xref/CUSTOMERPARTY_ACCOUNTID.xref&quot;,&quot;COMMON&quot;,bpws:getVariableData('inputVariable','payload','/ns3:CreateReceivedPaymentEBM/ns3:DataArea/ns3:CreateReceivedPayment/ns4:PayFromPartyReference/ns4:PartyIdentification/ns4:BusinessComponentID'),&quot;SEBL_01&quot;,true())"/>
            <to variable="Invoke_UpadatePaymentStatus_execute_InputVariable"
                part="request"
                query="/ns3:CreateReceivedPaymentResponseEBM/ns3:DataArea/ns3:CreateReceivedPaymentResponse/ns4:PayFromPartyReference/ns4:CustomerPartyAccountIdentification/ns4:ID"/>
          </copy>
          <copy bpelx:ignoreMissingFromData="yes">
             <from expression="'Failed'"/>
            <to variable="Invoke_UpadatePaymentStatus_execute_InputVariable"
                part="request"
                query="/ns3:CreateReceivedPaymentResponseEBM/ns3:DataArea/ns3:CreateReceivedPaymentResponse/ns4:Status/ns4:Code"/>
          </copy>
          <copy bpelx:ignoreMissingFromData="yes">
             <from expression="'BRM_Failure'"/>
            <to variable="Invoke_UpadatePaymentStatus_execute_InputVariable"
                part="request"
                query="/ns3:CreateReceivedPaymentResponseEBM/ns3:DataArea/ns3:CreateReceivedPaymentResponse/ns3:Description"/>
          </copy> <copy bpelx:ignoreMissingFromData="yes">
            <from variable="inputVariable" part="payload"
                  query="/ns3:CreateReceivedPaymentEBM/ns3:DataArea/ns3:CreateReceivedPayment/ns4:PayFromPartyReference/ns4:PartyIdentification/ns4:AlternateObjectKey/ns4:ID"/>
            <to variable="Invoke_UpadatePaymentStatus_execute_InputVariable"
                part="request"
                query="/ns3:CreateReceivedPaymentResponseEBM/ns3:DataArea/ns3:CreateReceivedPaymentResponse/ns4:Identification/ns4:AlternateObjectKey/ns4:ID"/>
          </copy>
<copy bpelx:ignoreMissingFromData="yes">
<from variable="inputVariable" part="payload"
                            query="/ns3:CreateReceivedPaymentEBM/ns3:DataArea/ns3:CreateReceivedPayment/ns3:Custom/ns8:TransactionCode"/>
           <to variable="Invoke_UpadatePaymentStatus_execute_InputVariable"
                part="request"
                query="/ns3:CreateReceivedPaymentResponseEBM/ns3:DataArea/ns3:CreateReceivedPaymentResponse/ns3:Custom/ns8:TransactionCode"/>
          </copy>		  
        </assign>
        <invoke name="Invoke_UpadatePaymentStatus"
                inputVariable="Invoke_UpadatePaymentStatus_execute_InputVariable"
                partnerLink="UpdatePaymentReceipt" portType="ns15:execute_ptt"
                operation="execute" bpelx:invokeAsDetail="no"/>
      </sequence>
    </catch>
    <catch faultName="ns14:fault" faultVariable="BRMFaultVar">
      <sequence name="Sequence_BRMFault">
        <assign name="Assign_BRMFault">
          <copy>
            <from expression="ora:processXSLT('xsl/EBM_to_Fault.xsl',bpws:getVariableData('inputVariable','payload'))"/>
            <to variable="AIAAsyncErrorHandling_Input" part="FaultMessage"
                query="/ns4:Fault"/>
          </copy>
          <copy>
            <from variable="BRMFaultVar" part="AIAFault"
                  query="/ns4:Fault/ns4:FaultNotification/ns4:FaultMessage/ns4:Code"/>
            <to variable="AIAAsyncErrorHandling_Input" part="FaultMessage"
                query="/ns4:Fault/ns4:FaultNotification/ns4:FaultMessage/ns4:Code"/>
          </copy>
          <copy>
            <from variable="BRMFaultVar" part="AIAFault"
                  query="/ns4:Fault/ns4:FaultNotification/ns4:FaultMessage/ns4:Text"/>
            <to variable="AIAAsyncErrorHandling_Input" part="FaultMessage"
                query="/ns4:Fault/ns4:FaultNotification/ns4:FaultMessage/ns4:Text"/>
          </copy>
          <copy bpelx:insertMissingToData="yes">
            <from expression="'Auto-Debit Payment Failure'"/>
            <to variable="AIAAsyncErrorHandling_Input" part="FaultMessage"
                query="/ns4:Fault/ns4:EBMReference/ns4:BusinessScopeReference/ns4:InstanceID"/>
          </copy>
          <copy>
            <from expression="xp20:current-dateTime()"/>
            <to variable="AIAAsyncErrorHandling_Input" part="FaultMessage"
                query="/ns4:Fault/ns4:FaultNotification/ns4:ReportingDateTime"/>
          </copy>
          <copy>
            <from expression="ora:getCompositeName()"/>
            <to variable="AIAAsyncErrorHandling_Input" part="FaultMessage"
                query="/ns4:Fault/ns4:FaultNotification/ns4:FaultingService/ns4:ID"/>
          </copy>
          <copy>
            <from expression="'BPEL'"/>
            <to variable="AIAAsyncErrorHandling_Input" part="FaultMessage"
                query="/ns4:Fault/ns4:FaultNotification/ns4:FaultingService/ns4:ImplementationCode"/>
          </copy>
          <copy>
            <from expression="ora:getCompositeInstanceId()"/>
            <to variable="AIAAsyncErrorHandling_Input" part="FaultMessage"
                query="/ns4:Fault/ns4:FaultNotification/ns4:FaultingService/ns4:InstanceID"/>
          </copy>
          <copy bpelx:insertMissingToData="yes">
            <from expression="'COMMON'"/>
            <to variable="AIAAsyncErrorHandling_Input" part="FaultMessage"
                query="/ns4:Fault/ns4:EBMReference/ns4:SenderReference/ns4:ObjectCrossReference/ns4:SenderObjectIdentification/ns4:AlternateObjectKey/ns4:ID/@schemeAgencyID"/>
          </copy>
          <copy bpelx:insertMissingToData="yes">
            <from variable="inputVariable" part="payload"
                  query="/ns3:CreateReceivedPaymentEBM/ns3:DataArea/ns3:CreateReceivedPayment/ns4:PayFromPartyReference/ns4:CustomerPartyAccountIdentification/ns4:BusinessComponentID"/>
            <to variable="AIAAsyncErrorHandling_Input" part="FaultMessage"
                query="/ns4:Fault/ns4:EBMReference/ns4:SenderReference/ns4:ObjectCrossReference/ns4:SenderObjectIdentification/ns4:AlternateObjectKey/ns4:ID"/>
          </copy>
          <copy bpelx:insertMissingToData="yes">
            <from expression="'SEBL_01'"/>
            <to variable="AIAAsyncErrorHandling_Input" part="FaultMessage"
                query="/ns4:Fault/ns4:EBMReference/ns4:SenderReference/ns4:ObjectCrossReference/ns4:SenderObjectIdentification/ns4:AlternateObjectKey/ns4:ID/@schemeAgencyID"/>
          </copy>
          <copy bpelx:insertMissingToData="yes">
            <from expression="xref:lookupXRef(&quot;oramds:/apps/AIAMetaData/xref/CUSTOMERPARTY_ACCOUNTID.xref&quot;,&quot;COMMON&quot;,bpws:getVariableData('inputVariable','payload','/ns3:CreateReceivedPaymentEBM/ns3:DataArea/ns3:CreateReceivedPayment/ns4:PayFromPartyReference/ns4:CustomerPartyAccountIdentification/ns4:BusinessComponentID'),&quot;SEBL_01&quot;,true())"/>
            <to variable="AIAAsyncErrorHandling_Input" part="FaultMessage"
                query="/ns4:Fault/ns4:EBMReference/ns4:SenderReference/ns4:ObjectCrossReference/ns4:SenderObjectIdentification/ns4:AlternateObjectKey/ns4:ID"/>
          </copy>
        </assign>
        <invoke name="ErrorHandler" inputVariable="AIAAsyncErrorHandling_Input"
                partnerLink="AIAAsyncErrorHandlingBPELProcess1"
                portType="aiaerrorws:AIAAsyncErrorHandlingBPELProcess"
                operation="initiate" bpelx:invokeAsDetail="no"/>
        <assign name="Assign_BRMPaymentPosting_Update"> 
         <copy bpelx:insertMissingToData="yes">
                            <from expression="'BRM_Failure'"/>
                            <to variable="AutoPaymentStatus"/>
                          </copy>
          <copy bpelx:ignoreMissingFromData="yes">
            <from variable="inputVariable" part="payload"
                  query="/ns3:CreateReceivedPaymentEBM/ns3:DataArea/ns3:CreateReceivedPayment/ns3:Custom/ns8:PaymentId"/>
            <to variable="Invoke_UpadatePaymentStatus_execute_InputVariable"
                part="request"
                query="/ns3:CreateReceivedPaymentResponseEBM/ns3:DataArea/ns3:CreateReceivedPaymentResponse/ns3:Custom/ns8:PaymentId"/>
          </copy><copy bpelx:ignoreMissingFromData="yes">
            <from expression="'BRM_Failure'"/>
             <to variable="Invoke_UpadatePaymentStatus_execute_InputVariable"
                part="request"
                query="/ns3:CreateReceivedPaymentResponseEBM/ns3:DataArea/ns3:CreateReceivedPaymentResponse/ns3:Description"/>
          </copy>
          <copy bpelx:ignoreMissingFromData="yes">
            <from variable="outputVariable" part="payload"
                  query="/ns3:QueryReceivedPaymentListResponseEBM/ns4:EBMHeader"/>
            <to variable="Invoke_UpadatePaymentStatus_execute_InputVariable"
                part="request"
                query="/ns3:CreateReceivedPaymentResponseEBM/ns4:EBMHeader"/>
          </copy>
          <copy bpelx:ignoreMissingFromData="yes">
            <from expression="xref:lookupXRef(&quot;oramds:/apps/AIAMetaData/xref/CUSTOMERPARTY_ACCOUNTID.xref&quot;,&quot;COMMON&quot;,bpws:getVariableData('inputVariable','payload','/ns3:CreateReceivedPaymentEBM/ns3:DataArea/ns3:CreateReceivedPayment/ns4:PayFromPartyReference/ns4:PartyIdentification/ns4:BusinessComponentID'),&quot;SEBL_01&quot;,true())"/>
            <to variable="Invoke_UpadatePaymentStatus_execute_InputVariable"
                part="request"
                query="/ns3:CreateReceivedPaymentResponseEBM/ns3:DataArea/ns3:CreateReceivedPaymentResponse/ns4:PayFromPartyReference/ns4:CustomerPartyAccountIdentification/ns4:ID"/>
          </copy>
          <copy bpelx:ignoreMissingFromData="yes">
            <from expression="'Failed'"/>
            <to variable="Invoke_UpadatePaymentStatus_execute_InputVariable"
                part="request"
                query="/ns3:CreateReceivedPaymentResponseEBM/ns3:DataArea/ns3:CreateReceivedPaymentResponse/ns4:Status/ns4:Code"/>
          </copy><copy>
            <from variable="Status"/>
            <to variable="Invoke_UpadatePaymentStatus_execute_InputVariable"
                part="request"
                query="/ns3:CreateReceivedPaymentResponseEBM/ns3:DataArea/ns3:CreateReceivedPaymentResponse/ns3:Custom/ns8:StepNumber"/>
          </copy>
		   <copy bpelx:ignoreMissingFromData="yes">
            <from variable="inputVariable" part="payload"
                  query="/ns3:CreateReceivedPaymentEBM/ns3:DataArea/ns3:CreateReceivedPayment/ns4:PayFromPartyReference/ns4:PartyIdentification/ns4:AlternateObjectKey/ns4:ID"/>
            <to variable="Invoke_UpadatePaymentStatus_execute_InputVariable"
                part="request"
                query="/ns3:CreateReceivedPaymentResponseEBM/ns3:DataArea/ns3:CreateReceivedPaymentResponse/ns4:Identification/ns4:AlternateObjectKey/ns4:ID"/>
          </copy>
<copy bpelx:ignoreMissingFromData="yes">
<from variable="inputVariable" part="payload"
                            query="/ns3:CreateReceivedPaymentEBM/ns3:DataArea/ns3:CreateReceivedPayment/ns3:Custom/ns8:TransactionCode"/>
           <to variable="Invoke_UpadatePaymentStatus_execute_InputVariable"
                part="request"
                query="/ns3:CreateReceivedPaymentResponseEBM/ns3:DataArea/ns3:CreateReceivedPaymentResponse/ns3:Custom/ns8:TransactionCode"/>
          </copy>		  
        </assign>
        <invoke name="Invoke_UpadatePaymentStatus"
                inputVariable="Invoke_UpadatePaymentStatus_execute_InputVariable"
                partnerLink="UpdatePaymentReceipt" portType="ns15:execute_ptt"
                operation="execute" bpelx:invokeAsDetail="no"/>
      </sequence>
    </catch>
    <catchAll>
      <sequence name="Sequence10">
        <assign name="Assign_Fault">
         <copy>
            <from expression="ora:processXSLT('xsl/EBM_to_Fault_1.xsl',bpws:getVariableData('inputVariable','payload'))"/>
            <to variable="AIAAsyncErrorHandling_Input1" part="FaultMessage"
                query="/ns4:Fault"/>
          </copy>
          <copy>
            <from variable="SystemFaultMessage" part="code"/>
            <to variable="AIAAsyncErrorHandling_Input1" part="FaultMessage"
                query="/ns4:Fault/ns4:FaultNotification/ns4:FaultMessage/ns4:Code"/>
          </copy>
          <copy>
            <from variable="SystemFaultMessage" part="summary"/>
            <to variable="AIAAsyncErrorHandling_Input1" part="FaultMessage"
                query="/ns4:Fault/ns4:FaultNotification/ns4:FaultMessage/ns4:Text"/>
          </copy>
          <!--    Description Populate Start   -->
          <copy bpelx:ignoreMissingFromData="yes">
            <from expression="concat('BRM',':',bpws:getVariableData('inputVariable','payload','/ns3:CreateReceivedPaymentEBM/ns3:DataArea/ns3:CreateReceivedPayment/ns3:PaymentMethodCode'),':',bpws:getVariableData('inputVariable','payload','/ns3:CreateReceivedPaymentEBM/ns3:DataArea/ns3:CreateReceivedPayment/ns4:BankPayment/ns4:Identification/ns4:ID'),':',bpws:getVariableData('FaultVar','AIAFault','/ns4:Fault/ns4:FaultNotification/ns4:FaultMessage/ns4:Text'),bpws:getVariableData('SystemFaultMessage','summary'))"/>
            <to variable="AIAAsyncErrorHandling_Input1" part="FaultMessage"
                query="/ns4:Fault/ns4:FaultNotification/ns4:FaultMessage/ns4:Text"/>
          </copy>
          <!--	Description Populate	-->
          <copy>
            <from variable="SystemFaultMessage" part="detail"/>
            <to variable="AIAAsyncErrorHandling_Input1" part="FaultMessage"
                query="/ns4:Fault/ns4:FaultNotification/ns4:FaultMessage/ns4:Stack"/>
          </copy>          
          <copy bpelx:ignoreMissingFromData="yes">
            <from expression="xp20:current-dateTime()"/>
            <to variable="AIAAsyncErrorHandling_Input1" part="FaultMessage"
                query="/ns4:Fault/ns4:FaultNotification/ns4:ReportingDateTime"/>
          </copy>
          <copy bpelx:ignoreMissingFromData="yes">
            <from expression="ora:getCompositeName()"/>
            <to variable="AIAAsyncErrorHandling_Input1" part="FaultMessage"
                query="/ns4:Fault/ns4:FaultNotification/ns4:FaultingService/ns4:ID"/>
          </copy>
          <copy bpelx:ignoreMissingFromData="yes">
            <from expression="'BPEL'"/>
            <to variable="AIAAsyncErrorHandling_Input1" part="FaultMessage"
                query="/ns4:Fault/ns4:FaultNotification/ns4:FaultingService/ns4:ImplementationCode"/>
          </copy>
          <copy bpelx:ignoreMissingFromData="yes">
            <from expression="ora:getCompositeInstanceId()"/>
            <to variable="AIAAsyncErrorHandling_Input1" part="FaultMessage"
                query="/ns4:Fault/ns4:FaultNotification/ns4:FaultingService/ns4:InstanceID"/>
          </copy>
        </assign>
        <invoke name="ErrorHandler" inputVariable="AIAAsyncErrorHandling_Input1"
                partnerLink="AIAAsyncErrorHandlingBPELProcess1"
                portType="aiaerrorws:AIAAsyncErrorHandlingBPELProcess"
                operation="initiate" bpelx:invokeAsDetail="no"/>
      </sequence>
    </catchAll>
  </faultHandlers>
  <!-- 
    ////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
     ORCHESTRATION LOGIC                                               
     Set of activities coordinating the flow of messages across the    
     services integrated within this business process                  
    ////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
  -->
  <sequence name="main">
    <!-- Receive input from requestor. (Note: This maps to operation defined in ProcessPaymentEBF.wsdl) -->
    <receive name="receiveInput" partnerLink="processpaymentebf_client"
             portType="client:ProcessPaymentEBF" operation="process"
             variable="inputVariable" createInstance="yes"/>
    <assign name="Assign_input_to_Output">
      <copy>
        <from variable="inputVariable" part="payload"
              query="/ns3:CreateReceivedPaymentEBM/ns4:EBMHeader"/>
        <to variable="outputVariable" part="payload"
            query="/ns3:QueryReceivedPaymentListResponseEBM/ns4:EBMHeader"/>
      </copy>
      <copy>
        <from variable="inputVariable" part="payload"
              query="/ns3:CreateReceivedPaymentEBM/ns3:DataArea/ns3:CreateReceivedPayment"/>
        <to variable="outputVariable" part="payload"
            query="/ns3:QueryReceivedPaymentListResponseEBM/ns3:DataArea/ns3:QueryReceivedPaymentListResponse"/>
      </copy><copy>       
<from variable="inputVariable" part="payload"
                            query="/ns3:CreateReceivedPaymentEBM/ns3:DataArea/ns3:CreateReceivedPayment/ns3:Custom/ns8:PaymentStatus"/>
        <to variable="IncomingPaymentStatus"/>
      </copy>
    </assign>
    <switch name="Switch9">
      <case condition="bpws:getVariableData('inputVariable','payload','/ns3:CreateReceivedPaymentEBM/ns4:EBMHeader/ns4:Sender/ns4:ID')='BRM_01'">
        <sequence name="Sequence15">
<assign name="AssignAutopayTitle">
 <copy>
        <from expression="ora:setCompositeInstanceTitle(concat('AutoPay:', bpws:getVariableData('inputVariable','payload','/ns3:CreateReceivedPaymentEBM/ns3:DataArea/ns3:CreateReceivedPayment/ns3:Custom/ns8:VFQAccountNumber')))"/>
        <to variable="Title"/>
      </copy>
  </assign>
          <switch name="Switch12">
            <case condition="bpws:getVariableData('IncomingPaymentStatus') ='NewPayment'">
              <sequence>
                <assign name="Assign1">
                  <copy>                    
                    <from expression="'0'"/>
                    <to variable="Status"/>
                  </copy>
                </assign>
              </sequence>
            </case>
            <otherwise>
              <assign name="Assign7">
			  <copy>
                    <from expression="'100'"/>
                    <to variable="Status"/>
					</copy>
					</assign>
            </otherwise>
          </switch>
        </sequence>
      </case>
      <otherwise>
        <sequence name="Sequence14">
<assign name="AssignSiebelTitle">
 <copy>
        <from expression="ora:setCompositeInstanceTitle(concat('SiebelPay:', bpws:getVariableData('inputVariable','payload','/ns3:CreateReceivedPaymentEBM/ns3:DataArea/ns3:CreateReceivedPayment/ns3:Custom/ns8:VFQAccountNumber')))"/>
        <to variable="Title"/>
      </copy>
  </assign>
          <switch name="Switch11">
            <case condition="bpws:getVariableData('IncomingPaymentStatus') =''">
              <assign name="Assign2">
                <copy>
                  <from expression="'1'"/>
                  <to variable="Status"/>
                </copy>
              </assign>
            </case>
            <otherwise>
              <sequence>
                <assign name="Assign5">
                  <copy>
                    <from expression="'100'"/>
                    <to variable="Status"/>
                  </copy>
                </assign>
              </sequence>
            </otherwise>
          </switch>
        </sequence>
      </otherwise>
    </switch>    
    <scope name="PaymentGateway_Scope" variableAccessSerializable="no"
           bpelx:skipCondition="bpws:getVariableData('inputVariable','payload','/ns3:CreateReceivedPaymentEBM/ns4:EBMHeader/ns4:Sender/ns4:ID') = 'SEBL_01'">
      <sequence name="Sequence3">
        <switch name="Switch9">
          <case condition="bpws:getVariableData('Status') = '0' or bpws:getVariableData('IncomingPaymentStatus')='BANK_Failure'">
            <switch name="Switch1">
              <case condition="bpws:getVariableData('inputVariable','payload','/ns3:CreateReceivedPaymentEBM/ns3:DataArea/ns3:CreateReceivedPayment/ns3:PaymentMethodCode') = 'CREDIT CARD'">
                <sequence name="Sequence1">
                  <assign name="Input_to_MIGSGateway">
                    <copy>
                      <!--from expression="concat('',substring(oraext:generate-guid(),1,10))"/--><from variable="inputVariable" part="payload"
                            query="/ns3:CreateReceivedPaymentEBM/ns3:DataArea/ns3:CreateReceivedPayment/ns3:Custom/ns8:BillNo"/>
                      <to variable="Invoke_MIGS_process_InputVariable"
                          part="payload"
                          query="/ns2:ProcessPaymentRequest/ns2:OrderNumber"/>
                    </copy>
                    <!--copy>
                      <from variable="inputVariable" part="payload"
                            query="/ns3:CreateReceivedPaymentEBM/ns3:DataArea/ns3:CreateReceivedPayment/ns3:RequestAmount"/>
                      <to variable="Invoke_MIGS_process_InputVariable"
                          part="payload"
                          query="/ns2:ProcessPaymentRequest/ns2:Amount"/>
                    </copy-->
			<copy>
                      <from expression="round(bpws:getVariableData('inputVariable','payload','/ns3:CreateReceivedPaymentEBM/ns3:DataArea/ns3:CreateReceivedPayment/ns3:RequestAmount') * 100)"/>
                      <to variable="Invoke_MIGS_process_InputVariable"
                          part="payload"
                          query="/ns2:ProcessPaymentRequest/ns2:Amount"/>
                    </copy>
                    <copy>
                      <from variable="inputVariable" part="payload"
                            query="/ns3:CreateReceivedPaymentEBM/ns3:DataArea/ns3:CreateReceivedPayment/ns4:CreditCardPayment/ns4:CreditChargeAuthorization/ns4:CreditCard/ns4:Number"/>
                      <to variable="Invoke_MIGS_process_InputVariable"
                          part="payload"
                          query="/ns2:ProcessPaymentRequest/ns2:CardNumber"/>
                    </copy>
                    <copy>
                      <from variable="inputVariable" part="payload"
                            query="/ns3:CreateReceivedPaymentEBM/ns3:DataArea/ns3:CreateReceivedPayment/ns4:CreditCardPayment/ns4:CreditChargeAuthorization/ns4:CreditCard/ns4:ExpirationDate"/>
                      <to variable="Invoke_MIGS_process_InputVariable"
                          part="payload"
                          query="/ns2:ProcessPaymentRequest/ns2:CardExpiry"/>
                    </copy>
                    <copy>
                      <!--from variable="inputVariable" part="payload"
                            query="/ns3:CreateReceivedPaymentEBM/ns3:DataArea/ns3:CreateReceivedPayment/ns4:CreditCardPayment/ns4:CreditChargeAuthorization/ns4:CreditCard/ns4:SecurityCode"/-->
                      <from expression="'111'"/>
                      <to variable="Invoke_MIGS_process_InputVariable"
                          part="payload"
                          query="/ns2:ProcessPaymentRequest/ns2:CardSecurityCode"/>
                    </copy>
                  </assign>
                  <invoke name="Invoke_MIGS"
                          inputVariable="Invoke_MIGS_process_InputVariable"
                          outputVariable="Invoke_MIGS_process_OutputVariable"
                          partnerLink="ProcessMigsProv"
                          portType="ns2:PaymentProcessingMIGSProvABCSImpl"
                          operation="process" bpelx:invokeAsDetail="no"/>
                  <switch name="Switch3">
                    <case condition="bpws:getVariableData('Invoke_MIGS_process_OutputVariable','payload','/ns2:ProcessPaymentResponse/ns2:TransactionCode') !='0'">
                      <assign name="Assign_CC_OutputtoResponse">
                        <copy>
                          <from variable="Invoke_MIGS_process_OutputVariable"
                                part="payload"
                                query="/ns2:ProcessPaymentResponse/ns2:TransactionCode"/>
                          <!--to variable="outputVariable" part="payload"
                              query="/ns3:QueryReceivedPaymentListResponseEBM/ns3:DataArea/ns3:QueryReceivedPaymentListResponse/ns4:CreditCardPayment/ns4:CreditChargeAuthorizationResponse/ns4:ResponseCode"/-->
                          <to variable="outputVariable" part="payload"
                              query="/ns3:QueryReceivedPaymentListResponseEBM/ns3:DataArea/ns3:QueryReceivedPaymentListResponse/ns4:Status/ns4:Code"/>
                        </copy>
						<copy>
						  <from variable="Invoke_MIGS_process_OutputVariable"
                                part="payload"
                                query="/ns2:ProcessPaymentResponse/ns2:TransactionCode"/>
                           <to variable="inputVariable" part="payload"
                              query="/ns3:CreateReceivedPaymentEBM/ns3:DataArea/ns3:CreateReceivedPayment/ns3:Custom/ns8:TransactionCode"/>
                        </copy>
                        <copy>
                          <from expression="'1'"/>
                          <to variable="Status"/>
                        </copy>
                      </assign>
                    </case>
                    <otherwise>
                      <sequence name="Sequence11">
                        <sequence name="Sequence11">
                          <assign name="Assign_CCFailure_Response">
                            <copy>
                              <from expression="'0'"/>
                              <to variable="Status"/>
                            </copy>
                            <copy bpelx:insertMissingToData="yes">
                            <from expression="'BANK_Failure'"/>
                            <to variable="AutoPaymentStatus"/>
                          </copy>
          <copy>
            <from expression="ora:processXSLT('xsl/EBM_to_Fault_1.xsl',bpws:getVariableData('inputVariable','payload'))"/>
            <to variable="AIAAsyncErrorHandling_Input1" part="FaultMessage"
                query="/ns4:Fault"/>
          </copy>
          <copy>
            <from variable="SystemFaultMessage" part="code"/>
            <to variable="AIAAsyncErrorHandling_Input1" part="FaultMessage"
                query="/ns4:Fault/ns4:FaultNotification/ns4:FaultMessage/ns4:Code"/>
          </copy>
          <copy>
            <from variable="SystemFaultMessage" part="summary"/>
            <to variable="AIAAsyncErrorHandling_Input1" part="FaultMessage"
                query="/ns4:Fault/ns4:FaultNotification/ns4:FaultMessage/ns4:Text"/>
          </copy>
          <copy>
            <from variable="SystemFaultMessage" part="detail"/>
            <to variable="AIAAsyncErrorHandling_Input1" part="FaultMessage"
                query="/ns4:Fault/ns4:FaultNotification/ns4:FaultMessage/ns4:Stack"/>
          </copy>          
          <copy bpelx:ignoreMissingFromData="yes">
            <from expression="xp20:current-dateTime()"/>
            <to variable="AIAAsyncErrorHandling_Input1" part="FaultMessage"
                query="/ns4:Fault/ns4:FaultNotification/ns4:ReportingDateTime"/>
          </copy>
          <copy bpelx:ignoreMissingFromData="yes">
            <from expression="ora:getCompositeName()"/>
            <to variable="AIAAsyncErrorHandling_Input1" part="FaultMessage"
                query="/ns4:Fault/ns4:FaultNotification/ns4:FaultingService/ns4:ID"/>
          </copy>
          <copy bpelx:ignoreMissingFromData="yes">
            <from expression="'BPEL'"/>
            <to variable="AIAAsyncErrorHandling_Input1" part="FaultMessage"
                query="/ns4:Fault/ns4:FaultNotification/ns4:FaultingService/ns4:ImplementationCode"/>
          </copy>
          <copy bpelx:ignoreMissingFromData="yes">
            <from expression="ora:getCompositeInstanceId()"/>
            <to variable="AIAAsyncErrorHandling_Input1" part="FaultMessage"
                query="/ns4:Fault/ns4:FaultNotification/ns4:FaultingService/ns4:InstanceID"/>
          </copy>
                          </assign>
						  <sequence name="Sequence11_TT">
                            <assign name="Assign_TT_description_CC">
                              <copy bpelx:ignoreMissingFromData="yes">
                                <from expression="concat('BRM',':',bpws:getVariableData('inputVariable','payload','/ns3:CreateReceivedPaymentEBM/ns3:DataArea/ns3:CreateReceivedPayment/ns3:PaymentMethodCode'),':MIGS:',bpws:getVariableData('Invoke_MIGS_process_OutputVariable','payload','/ns2:ProcessPaymentResponse/ns2:Description'))"/>
                                <to variable="AIAAsyncErrorHandling_Input1"
                                    part="FaultMessage"
                                    query="/ns4:Fault/ns4:FaultNotification/ns4:FaultMessage/ns4:Text"/>
                              </copy>
                            </assign>
							</sequence>
                            <!--    Description Populate    -->
                          <invoke name="ErrorHandler12"
                                  inputVariable="AIAAsyncErrorHandling_Input1"
                                  partnerLink="AIAAsyncErrorHandlingBPELProcess1"
                                  portType="aiaerrorws:AIAAsyncErrorHandlingBPELProcess"
                                  operation="initiate"
                                  bpelx:invokeAsDetail="no"/>
                        </sequence>
                      </sequence>
                    </otherwise>
                  </switch>
                </sequence>
              </case>
              <otherwise>
                <sequence name="Sequence2">
                  <assign name="Input_to_DDGenericGateway">
                    <copy>
                      <!--from expression="concat('',substring(oraext:generate-guid(),1,10))"/--><from variable="inputVariable" part="payload"
                            query="/ns3:CreateReceivedPaymentEBM/ns3:DataArea/ns3:CreateReceivedPayment/ns3:Custom/ns8:BillNo"/>
                      <to variable="Invoke_GenericDDBankPayments_process_InputVariable"
                          part="payload"
                          query="/ns11:ProcessPaymentRequest/ns11:OrderNumber"/>
                    </copy>
                    <copy>
                      <from variable="inputVariable" part="payload"
                            query="/ns3:CreateReceivedPaymentEBM/ns3:DataArea/ns3:CreateReceivedPayment/ns3:Custom/ns8:VFQAccountNumber"/>
                      <to variable="Invoke_GenericDDBankPayments_process_InputVariable"
                          part="payload"
                          query="/ns11:ProcessPaymentRequest/ns11:SiebelAccountNumber"/>
                    </copy>
                    <copy>
                      <from expression="round(bpws:getVariableData('inputVariable','payload','/ns3:CreateReceivedPaymentEBM/ns3:DataArea/ns3:CreateReceivedPayment/ns3:AuthorizationAmount')) * 100"/>
                      <to variable="Invoke_GenericDDBankPayments_process_InputVariable"
                          part="payload"
                          query="/ns11:ProcessPaymentRequest/ns11:Amount"/>
                    </copy>
                    <copy>
                      <from expression="'Automatic Debit'"/>
                      <to variable="Invoke_GenericDDBankPayments_process_InputVariable"
                          part="payload"
                          query="/ns11:ProcessPaymentRequest/ns11:PaymentMethod"/>
                    </copy>
                    <copy>
                      <from variable="inputVariable" part="payload"
                            query="/ns3:CreateReceivedPaymentEBM/ns3:DataArea/ns3:CreateReceivedPayment/ns4:BankPayment/ns4:Identification/ns4:ID"/>
                      <to variable="Invoke_GenericDDBankPayments_process_InputVariable"
                          part="payload"
                          query="/ns11:ProcessPaymentRequest/ns11:PaymentDetails/ns11:BankPaymentDetails/ns11:BankId"/>
                    </copy> <copy>
                      <from variable="inputVariable" part="payload"
                            query="/ns3:CreateReceivedPaymentEBM/ns3:DataArea/ns3:CreateReceivedPayment/ns4:BankPayment/ns4:Identification/ns4:ID"/>
                      <to variable="Invoke_GenericDDBankPayments_process_InputVariable"
                          part="payload"
                          query="/ns11:ProcessPaymentRequest/ns11:PaymentDetails/ns11:BankPaymentDetails/ns11:BankSortCode"/>
                    </copy>
                    <copy>
                      <from variable="inputVariable" part="payload"
                            query="/ns3:CreateReceivedPaymentEBM/ns3:DataArea/ns3:CreateReceivedPayment/ns4:BankPayment/ns4:PayFromBankAccount/ns4:AccountNumber"/>
                      <to variable="Invoke_GenericDDBankPayments_process_InputVariable"
                          part="payload"
                          query="/ns11:ProcessPaymentRequest/ns11:PaymentDetails/ns11:BankPaymentDetails/ns11:BankAccountNumber"/>
                    </copy>
                    <copy>
                      <from variable="inputVariable" part="payload"
                            query="/ns3:CreateReceivedPaymentEBM/ns3:DataArea/ns3:CreateReceivedPayment//ns3:Custom/ns8:SecurityId"/>
                      <to variable="Invoke_GenericDDBankPayments_process_InputVariable"
                          part="payload"
                          query="/ns11:ProcessPaymentRequest/ns11:PaymentDetails/ns11:BankPaymentDetails/ns11:BankCustomerId"/>
                    </copy>
                  </assign>
                  <invoke name="Invoke_GenericDDBankPayments"
                          inputVariable="Invoke_GenericDDBankPayments_process_InputVariable"
                          outputVariable="Invoke_GenericDDBankPayments_process_OutputVariable"
                          partnerLink="GenericDDBankPayments"
                          portType="ns11:PaymentCollectionDDSiebelReqABCSImpl"
                          operation="process" bpelx:invokeAsDetail="no"/>
                  <switch name="Switch4">
                    <case condition="bpws:getVariableData('Invoke_GenericDDBankPayments_process_OutputVariable','payload','/ns11:ProcessPaymentResponse/ns11:TransactionCode') !=''">
                      <assign name="Assign_DD_Output_to_Response">
                        <copy>
                          <from expression="'1'"/>
                          <to variable="Status"/>
                        </copy>
						<copy>
						  <from variable="Invoke_GenericDDBankPayments_process_OutputVariable"
                                part="payload"
                                query="/ns11:ProcessPaymentResponse/ns11:TransactionCode"/>
                          <!--to variable="outputVariable" part="payload"
                              query="/ns3:QueryReceivedPaymentListResponseEBM/ns3:DataArea/ns3:QueryReceivedPaymentListResponse/ns4:CreditCardPayment/ns4:CreditChargeAuthorizationResponse/ns4:ResponseCode"/-->
                          <to variable="outputVariable" part="payload"
                              query="/ns3:QueryReceivedPaymentListResponseEBM/ns3:DataArea/ns3:QueryReceivedPaymentListResponse/ns4:Status/ns4:Code"/>
							  <!--to variable="outputVariable" part="payload"
                              query="/ns3:QueryReceivedPaymentListResponseEBM/ns3:DataArea/ns3:QueryReceivedPaymentListResponse/ns3:Custom/ns8:TransactionCode"/-->
                        </copy>
						<copy>
						  <from variable="Invoke_GenericDDBankPayments_process_OutputVariable"
                                part="payload"
                                query="/ns11:ProcessPaymentResponse/ns11:TransactionCode"/>
                           <to variable="inputVariable" part="payload"
                              query="/ns3:CreateReceivedPaymentEBM/ns3:DataArea/ns3:CreateReceivedPayment/ns3:Custom/ns8:TransactionCode"/>
                        </copy>
                      </assign>
                    </case>
                    <otherwise>
                      <sequence name="Sequence12">
                        <assign name="Assign_DDFailure_Response">
                          <copy>
                            <from expression="'0'"/>
                            <to variable="Status"/>
                          </copy>
                          <copy bpelx:insertMissingToData="yes">
                            <from expression="'BANK_Failure'"/>
                            <to variable="AutoPaymentStatus"/>
                          </copy>
                          <copy bpelx:insertMissingToData="yes">
                            <from expression="'BANK_Failure'"/>
                            <to variable="outputVariable" part="payload"
                                query="/ns3:QueryReceivedPaymentListResponseEBM/ns3:DataArea/ns3:QueryReceivedPaymentListResponse/ns4:Status"/>
                          </copy>
                          <copy>
            <from expression="ora:processXSLT('xsl/EBM_to_Fault_1.xsl',bpws:getVariableData('inputVariable','payload'))"/>
            <to variable="AIAAsyncErrorHandling_Input1" part="FaultMessage"
                query="/ns4:Fault"/>
          </copy>
          <copy>
            <from variable="SystemFaultMessage" part="code"/>
            <to variable="AIAAsyncErrorHandling_Input1" part="FaultMessage"
                query="/ns4:Fault/ns4:FaultNotification/ns4:FaultMessage/ns4:Code"/>
          </copy>
          <copy>
            <from variable="SystemFaultMessage" part="summary"/>
            <to variable="AIAAsyncErrorHandling_Input1" part="FaultMessage"
                query="/ns4:Fault/ns4:FaultNotification/ns4:FaultMessage/ns4:Text"/>
          </copy>
          <copy>
            <from variable="SystemFaultMessage" part="detail"/>
            <to variable="AIAAsyncErrorHandling_Input1" part="FaultMessage"
                query="/ns4:Fault/ns4:FaultNotification/ns4:FaultMessage/ns4:Stack"/>
          </copy>
          <!--copy bpelx:ignoreMissingFromData="yes" bpelx:ignoreMissingToData="yes">
            <from expression="'AutoPayment Failure'"/>
            <to variable="AIAAsyncErrorHandling_Input1" part="FaultMessage"
                query="/ns4:Fault/ns4:EBMReference/ns4:BusinessScopeReference/ns4:InstanceID"/>
          </copy-->
          <copy bpelx:ignoreMissingFromData="yes">
            <from expression="xp20:current-dateTime()"/>
            <to variable="AIAAsyncErrorHandling_Input1" part="FaultMessage"
                query="/ns4:Fault/ns4:FaultNotification/ns4:ReportingDateTime"/>
          </copy>
          <copy bpelx:ignoreMissingFromData="yes">
            <from expression="ora:getCompositeName()"/>
            <to variable="AIAAsyncErrorHandling_Input1" part="FaultMessage"
                query="/ns4:Fault/ns4:FaultNotification/ns4:FaultingService/ns4:ID"/>
          </copy>
          <copy bpelx:ignoreMissingFromData="yes">
            <from expression="'BPEL'"/>
            <to variable="AIAAsyncErrorHandling_Input1" part="FaultMessage"
                query="/ns4:Fault/ns4:FaultNotification/ns4:FaultingService/ns4:ImplementationCode"/>
          </copy>
          <copy bpelx:ignoreMissingFromData="yes">
            <from expression="ora:getCompositeInstanceId()"/>
            <to variable="AIAAsyncErrorHandling_Input1" part="FaultMessage"
                query="/ns4:Fault/ns4:FaultNotification/ns4:FaultingService/ns4:InstanceID"/>
          </copy>
             </assign>
                        <scope name="Scope1">
                          <sequence name="Sequence13">
                            <assign name="Assign_TT_description_DD">
                              <copy bpelx:ignoreMissingFromData="yes">
                                <from expression="concat('BRM',':',bpws:getVariableData('inputVariable','payload','/ns3:CreateReceivedPaymentEBM/ns3:DataArea/ns3:CreateReceivedPayment/ns3:PaymentMethodCode'),':',bpws:getVariableData('inputVariable','payload','/ns3:CreateReceivedPaymentEBM/ns3:DataArea/ns3:CreateReceivedPayment/ns4:BankPayment/ns4:Identification/ns4:ID'),':',bpws:getVariableData('Invoke_GenericDDBankPayments_process_OutputVariable','payload','/ns11:ProcessPaymentResponse/ns11:Description'))"/>
                                <to variable="AIAAsyncErrorHandling_Input1"
                                    part="FaultMessage"
                                    query="/ns4:Fault/ns4:FaultNotification/ns4:FaultMessage/ns4:Text"/>
                              </copy>
                            </assign>
                            <invoke name="Errorhandler13"
                                    inputVariable="AIAAsyncErrorHandling_Input1"
                                    partnerLink="AIAAsyncErrorHandlingBPELProcess1"
                                    portType="aiaerrorws:AIAAsyncErrorHandlingBPELProcess"
                                    operation="initiate"
                                    bpelx:invokeAsDetail="no"/>
                          </sequence>
                        </scope>
                      </sequence>
                    </otherwise>
                  </switch>
                </sequence>
              </otherwise>
            </switch>
          </case>
          <otherwise/>
        </switch>
      </sequence>
    </scope>
    <scope name="Scope_PaymentPosting_ASAP" variableAccessSerializable="no">
      <switch name="Switch5">
        <case condition="bpws:getVariableData('Status') ='1' or bpws:getVariableData('IncomingPaymentStatus')='NETWORK_Failure' ">
          <sequence name="Sequence4">
            <switch name="Switch10">
              <case condition="bpws:getVariableData('inputVariable','payload','/ns3:CreateReceivedPaymentEBM/ns3:DataArea/ns3:CreateReceivedPayment/ns3:Custom/ns8:MSISDN')='' and (bpws:getVariableData('inputVariable','payload','/ns3:CreateReceivedPaymentEBM/ns4:EBMHeader/ns4:Sender/ns4:ID')='SEBL_01' or bpws:getVariableData('inputVariable','payload','/ns3:CreateReceivedPaymentEBM/ns4:EBMHeader/ns4:Sender/ns4:ID')='BRM_01')">
                <assign name="Assign4">
                  <copy>
                    <from expression="'4'"/>
                    <to variable="Status"/>
                  </copy>
                </assign>
              </case>
              <otherwise>
                <sequence name="Sequence16">
                  <sequence>
                    <assign name="Transform_ASAP_Input">
                      <bpelx:annotation>
                        <bpelx:pattern>transformation</bpelx:pattern>
                      </bpelx:annotation>
                      <copy>
                        <from expression="ora:doXSLTransformForDoc('xsl/Transformation_To_ASAPProv.xsl', $inputVariable.payload)"/>
                        <to variable="InvokeAsapProvInVar"
                            part="CreateAccountBalanceAdjustmentListEBM"/>
                      </copy>
                    </assign>
                    <invoke name="InvokeAsapProv" bpelx:invokeAsDetail="no"
                            inputVariable="InvokeAsapProvInVar"
                            partnerLink="ProcessAccountBalanceAdjustmentAsapProvABCSImpl"
                            portType="ns16:ProcessAccountBalanceAdjustmentAsapProvABCSImpl"
                            operation="process"/>
                    <receive name="OnResultAsapProv" createInstance="no"
                             variable="OnResultAsapProvOutVar"
                             partnerLink="ProcessAccountBalanceAdjustmentAsapProvABCSImpl"
                             portType="ns16:ProcessAccountBalanceAdjustmentAsapProvABCSImplCallback"
                             operation="processResponse"/>
                    <!--invoke name="Invoke_ASAP_Order"
                            inputVariable="Invoke_ASAP_Order_initiate_InputVariable"
                            partnerLink="ASAPOrder_Input"
                            portType="ns12:AsapOrder" operation="initiate"
                            bpelx:invokeAsDetail="no"/>
                    <receive name="Receive1" createInstance="no"
                             variable="Receive1_onResult_InputVariable"
                             partnerLink="ASAPOrder_Input"
                             portType="ns12:AsapOrderCallback"
                             operation="onResult"/-->
                    <switch name="Switch6">
                      <case condition="bpws:getVariableData('OnResultAsapProvOutVar','CreateAccountBalanceAdjustmentListResponseEBM','/nsadj:CreateAccountBalanceAdjustmentListResponseEBM/nsadj:DataArea/nsadj:CreateAccountBalanceAdjustmentListResponse/ns4:Status')='00000'">
                        <assign name="Assign_ASAP_Sucess-Response">
                          <copy>
                            <from expression="'4'"/>
                            <to variable="Status"/>
                          </copy>
                          <copy bpelx:insertMissingToData="yes">
                            <from expression="'ASAP_posting_Sucess'"/>
                            <to variable="outputVariable" part="payload"
                                query="/ns3:QueryReceivedPaymentListResponseEBM/ns3:DataArea/ns3:QueryReceivedPaymentListResponse/ns4:Status"/>
                          </copy>
                          <copy bpelx:insertMissingToData="yes">
                            <from expression="'Sucess'"/>
                            <to variable="AutoPaymentStatus"/>
                          </copy>
                        </assign>
                      </case>
                      <otherwise>
                        <assign name="Assign_ASAP_Failure_Code">
                        <!--Chnaged for MS CR   -->
                        <!--END -->
                          <copy>
                            <from expression="'4'"/>
                            <to variable="Status"/>
                          </copy>
                          <copy bpelx:insertMissingToData="yes">
                            <from expression="'Failed'"/>
                            <to variable="outputVariable" part="payload"
                                query="/ns3:QueryReceivedPaymentListResponseEBM/ns3:DataArea/ns3:QueryReceivedPaymentListResponse/ns4:Status"/>
                          </copy>
                          <copy bpelx:ignoreMissingToData="yes">
                            <from expression="'NETWORK_Failure'"/>
                            <to variable="Invoke_UpadatePaymentStatus_execute_InputVariable"
                                part="request"
                                query="/ns3:CreateReceivedPaymentResponseEBM/ns3:DataArea/ns3:CreateReceivedPaymentResponse/ns3:Description"/>
                          </copy>
                          <copy bpelx:insertMissingToData="yes">
                            <from expression="'NETWORK_Failure'"/>
                            <to variable="AutoPaymentStatus"/>
                          </copy>
                          <copy bpelx:insertMissingToData="yes">
                            <from expression="'NETWORK_FAILURE'"/>
                            <to variable="inputVariable" part="payload"
                                query="/ns3:CreateReceivedPaymentEBM/ns3:DataArea/ns3:CreateReceivedPayment/ns4:Status/ns4:Code"/>
                          </copy> 
<!-- Added for UNBAR_IA CR -->                         
                          <copy bpelx:insertMissingToData="yes">
                            <from expression="substring(bpws:getVariableData('OnResultAsapProvOutVar','CreateAccountBalanceAdjustmentListResponseEBM','/nsadj:CreateAccountBalanceAdjustmentListResponseEBM/nsadj:DataArea/nsadj:CreateAccountBalanceAdjustmentListResponse/nsadj:Description'),1,100)"/>
                            <to variable="Invoke_UpadatePaymentStatus_execute_InputVariable"
                                part="request"
                                query="/ns3:CreateReceivedPaymentResponseEBM/ns3:DataArea/ns4:CreateResponse"/>
                          </copy>
<!-- END -->
                        </assign>
                      </otherwise>
                    </switch>
                  </sequence>
                </sequence>
              </otherwise>
            </switch>
          </sequence>
        </case>
        <otherwise>
          <empty name="SkipASAP"/>
        </otherwise>
      </switch>
    </scope>
    <scope name="BRM_Payment_Posting_Scope" variableAccessSerializable="no">
      <!--faultHandlers>
        <catchAll>
          <sequence name="Sequence9">
            <sequence name="Sequence7">
              <sequence name="Sequence6">
                <assign name="Assign3">
                  <copy>
                    <from variable="Status"/>
                    <to variable="InvokeBRM_Fault_Update_execute_InputVariable"
                        part="request"
                        query="/ns3:CreateReceivedPaymentResponseEBM/ns3:DataArea/ns3:CreateReceivedPaymentResponse/ns3:Custom/ns8:StepNumber"/>
                  </copy>
                  <copy>
                    <from variable="inputVariable" part="payload"
                          query="/ns3:CreateReceivedPaymentEBM/ns3:DataArea/ns3:CreateReceivedPayment/ns4:PayFromPartyReference/ns4:PartyIdentification/ns4:AlternateObjectKey/ns4:ID"/>
                    <to variable="InvokeBRM_Fault_Update_execute_InputVariable"
                        part="request"
                        query="/ns3:CreateReceivedPaymentResponseEBM/ns3:DataArea/ns3:CreateReceivedPaymentResponse/ns4:Identification/ns4:AlternateObjectKey/ns4:ID"/>
                  </copy>
                  <copy>
                    <from expression="'Failed_At_BRM_Posting'"/>
                    <to variable="InvokeBRM_Fault_Update_execute_InputVariable"
                        part="request"
                        query="/ns3:CreateReceivedPaymentResponseEBM/ns3:DataArea/ns3:CreateReceivedPaymentResponse/ns4:Status/ns4:Description"/>
                  </copy>
                  <copy>
                    <from expression="'Failed_At_BRM_Posting'"/>
                    <to variable="InvokeBRM_Fault_Update_execute_InputVariable"
                        part="request"
                        query="/ns3:CreateReceivedPaymentResponseEBM/ns3:DataArea/ns3:CreateReceivedPaymentResponse/ns4:Status/ns4:Code"/>
                  </copy>
                </assign>
                <invoke name="Invoke1"
                        inputVariable="InvokeBRM_Fault_Update_execute_InputVariable"
                        partnerLink="UpdatePaymentReceipt"
                        portType="ns15:execute_ptt" operation="execute"
                        bpelx:invokeAsDetail="no"/>
              </sequence>
            </sequence>
          </sequence>
        </catchAll>
      </faultHandlers-->
      <switch name="Switch7">
        <case condition="bpws:getVariableData('Status')='4' or bpws:getVariableData('IncomingPaymentStatus')='BRM_Failure'">
          <sequence name="Sequence5">
            <assign name="Transform1">
              <bpelx:annotation>
                <bpelx:pattern>transformation</bpelx:pattern>
              </bpelx:annotation>
              <copy>
                <from expression="ora:doXSLTransformForDoc('xsl/Input_to_CreateReceivedPayment.xsl', $inputVariable.payload)"/>
                <to variable="Invoke_BRM_CreateReceivedPaymentRequestResponse_InputVariable"
                    part="CreateReceivedPaymentEBM"/>
              </copy>
            </assign>
            <invoke name="Invoke_BRM"
                    inputVariable="Invoke_BRM_CreateReceivedPaymentRequestResponse_InputVariable"
                    outputVariable="Invoke_BRM_CreateReceivedPaymentRequestResponse_OutputVariable"
                    partnerLink="CreateReceivedPaymentBRMProv_Plink"
                    portType="ns14:CreateReceivedPaymentBRMCommsProvABCSImpl"
                    operation="CreateReceivedPaymentRequestResponse"
                    bpelx:invokeAsDetail="no"/>
            <switch name="Switch8">
              <case condition="bpws:getVariableData('Invoke_BRM_CreateReceivedPaymentRequestResponse_OutputVariable','CreateReceivedPaymentResponseEBM','/ns3:CreateReceivedPaymentResponseEBM/ns3:DataArea/ns3:CreateReceivedPaymentResponse/ns3:ConfirmationNumber') != ''">
                <sequence name="Sequence17">
                  <assign name="Assign_BRM_PaymenPosting_Success">
                    <!--copy>
                    <from variable="Invoke_BRM_CreateReceivedPaymentRequestResponse_OutputVariable"
                          part="CreateReceivedPaymentResponseEBM"
                          query="/ns3:CreateReceivedPaymentResponseEBM/ns3:DataArea/ns3:CreateReceivedPaymentResponse/ns3:ConfirmationNumber"/>
                    <to variable="outputVariable" part="payload"
                        query="/ns3:QueryReceivedPaymentListResponseEBM/ns3:DataArea/ns3:QueryReceivedPaymentListResponse/ns3:ConfirmationNumber"/>
                  </copy-->
                    <!--copy>
                    <from expression="'Payment Posting Success'"/>
                    <to variable="outputVariable" part="payload"
                        query="/ns3:QueryReceivedPaymentListResponseEBM/ns3:DataArea/ns3:QueryReceivedPaymentListResponse/ns4:Status/ns4:Description"/>
                  </copy-->
                    <copy>
                      <from expression="'5'"/>
                      <to variable="Status"/>
                    </copy>
                  </assign>
                  <switch name="Switch13">
                    <case condition="bpws:getVariableData('AutoPaymentStatus')='NETWORK_Failure'">
<!-- Changed for Unbar IA CR -->
                      <assign name="Assign_Partial_Sucess">
                      <copy bpelx:insertMissingToData="yes">
                    <from expression="'Partial Success'"/>
                    <to variable="outputVariable" part="payload"
                        query="/ns3:QueryReceivedPaymentListResponseEBM/ns3:DataArea/ns3:QueryReceivedPaymentListResponse/ns4:Status"/>
                  </copy>
<copy bpelx:insertMissingToData="yes">
                            <from expression="'Partial Success'"/>
                            <to variable="AutoPaymentStatus"/>
                          </copy>
                      </assign>
<!-- END -->
                    </case>
                    <otherwise>
                      <assign name="Assign_Sucess">
                      <copy bpelx:insertMissingToData="yes">
                    <from expression="'Success'"/>
                    <to variable="outputVariable" part="payload"
                        query="/ns3:QueryReceivedPaymentListResponseEBM/ns3:DataArea/ns3:QueryReceivedPaymentListResponse/ns4:Status"/>
                  </copy>
<copy bpelx:insertMissingToData="yes">
                            <from expression="'Success'"/>
                            <to variable="AutoPaymentStatus"/>
                          </copy>
                      </assign>
                    </otherwise>
                  </switch>
                </sequence>
              </case>
              <otherwise>
                <assign name="Assign_BRMPaymentPosting_Failure">
                  <copy>
                    <from expression="'Failed'"/>
                    <to variable="outputVariable" part="payload"
                        query="/ns3:QueryReceivedPaymentListResponseEBM/ns3:DataArea/ns3:QueryReceivedPaymentListResponse/ns4:Status"/>
                  </copy>
                  <copy>
                    <from expression="'BRM_Failure'"/>
                    <to variable="Invoke_UpadatePaymentStatus_execute_InputVariable"
                part="request"
                query="/ns3:CreateReceivedPaymentResponseEBM/ns3:DataArea/ns3:CreateReceivedPaymentResponse/ns3:Description"/>
                  </copy>
                   <copy bpelx:insertMissingToData="yes">
                            <from expression="'BRM_Failure'"/>
                            <to variable="AutoPaymentStatus"/>
                          </copy>
                </assign>
              </otherwise>
            </switch>
          </sequence>
        </case>
        <otherwise>
          <empty name="SkipBRM"/>
        </otherwise>
      </switch>
    </scope>
    <scope name="UpdatePayment_Status" variableAccessSerializable="no">
      <sequence>
        <assign name="Assign_Payment_Update_Status">
          <copy bpelx:ignoreMissingFromData="yes">
            <from variable="outputVariable" part="payload"
                  query="/ns3:QueryReceivedPaymentListResponseEBM/ns3:DataArea/ns3:QueryReceivedPaymentListResponse/ns3:Custom/ns8:ReasonForRequest"/>
            <to variable="Invoke_UpadatePaymentStatus_execute_InputVariable"
                part="request"
                query="/ns3:CreateReceivedPaymentResponseEBM/ns3:DataArea/ns3:CreateReceivedPaymentResponse/ns3:Custom/ns8:Type"/>
          </copy>
          <copy>
            <from variable="Status"/>
            <to variable="Invoke_UpadatePaymentStatus_execute_InputVariable"
                part="request"
                query="/ns3:CreateReceivedPaymentResponseEBM/ns3:DataArea/ns3:CreateReceivedPaymentResponse/ns3:Custom/ns8:StepNumber"/>
          </copy>
          <copy>
            <from variable="AutoPaymentStatus"/>
            <to variable="Invoke_UpadatePaymentStatus_execute_InputVariable"
                part="request"
                query="/ns3:CreateReceivedPaymentResponseEBM/ns3:DataArea/ns3:CreateReceivedPaymentResponse/ns3:Custom/ns8:AutoPaymentStatus"/>
          </copy>
          <copy bpelx:ignoreMissingFromData="yes">
            <from variable="inputVariable" part="payload"
                  query="/ns3:CreateReceivedPaymentEBM/ns3:DataArea/ns3:CreateReceivedPayment/ns4:PayFromPartyReference/ns4:PartyIdentification/ns4:AlternateObjectKey/ns4:ID"/>
            <to variable="Invoke_UpadatePaymentStatus_execute_InputVariable"
                part="request"
                query="/ns3:CreateReceivedPaymentResponseEBM/ns3:DataArea/ns3:CreateReceivedPaymentResponse/ns4:Identification/ns4:AlternateObjectKey/ns4:ID"/>
          </copy>
<copy bpelx:ignoreMissingFromData="yes">
<from variable="inputVariable" part="payload"
                            query="/ns3:CreateReceivedPaymentEBM/ns3:DataArea/ns3:CreateReceivedPayment/ns3:Custom/ns8:TransactionCode"/>
           <to variable="Invoke_UpadatePaymentStatus_execute_InputVariable"
                part="request"
                query="/ns3:CreateReceivedPaymentResponseEBM/ns3:DataArea/ns3:CreateReceivedPaymentResponse/ns3:Custom/ns8:TransactionCode"/>
          </copy>
           <copy bpelx:ignoreMissingFromData="yes">
            <from variable="outputVariable" part="payload"
                  query="/ns3:QueryReceivedPaymentListResponseEBM/ns4:EBMHeader"/>
            <to variable="Invoke_UpadatePaymentStatus_execute_InputVariable"
                part="request"
                query="/ns3:CreateReceivedPaymentResponseEBM/ns4:EBMHeader"/>
          </copy>
          <copy bpelx:ignoreMissingFromData="yes">
            <from variable="outputVariable" part="payload"
                  query="/ns3:QueryReceivedPaymentListResponseEBM/ns3:DataArea/ns3:QueryReceivedPaymentListResponse/ns3:Custom/ns8:PaymentId"/>
            <to variable="Invoke_UpadatePaymentStatus_execute_InputVariable"
                part="request"
                query="/ns3:CreateReceivedPaymentResponseEBM/ns3:DataArea/ns3:CreateReceivedPaymentResponse/ns3:Custom/ns8:PaymentId"/>
          </copy>
          <copy bpelx:ignoreMissingFromData="yes">
            <from expression="xref:lookupXRef(&quot;oramds:/apps/AIAMetaData/xref/CUSTOMERPARTY_ACCOUNTID.xref&quot;,&quot;COMMON&quot;,bpws:getVariableData('inputVariable','payload','/ns3:CreateReceivedPaymentEBM/ns3:DataArea/ns3:CreateReceivedPayment/ns4:PayFromPartyReference/ns4:PartyIdentification/ns4:BusinessComponentID'),&quot;SEBL_01&quot;,true())"/>
            <to variable="Invoke_UpadatePaymentStatus_execute_InputVariable"
                part="request"
                query="/ns3:CreateReceivedPaymentResponseEBM/ns3:DataArea/ns3:CreateReceivedPaymentResponse/ns4:PayFromPartyReference/ns4:CustomerPartyAccountIdentification/ns4:ID"/>
          </copy>
          <!--copy bpelx:ignoreMissingFromData="yes">
            <from variable="outputVariable" part="payload"
                  query="/ns3:QueryReceivedPaymentListResponseEBM/ns3:DataArea/ns3:QueryReceivedPaymentListResponse/ns3:Description"/>
            <to variable="Invoke_UpadatePaymentStatus_execute_InputVariable"
                part="request"
                query="/ns3:CreateReceivedPaymentResponseEBM/ns3:DataArea/ns3:CreateReceivedPaymentResponse/ns3:Description"/>
          </copy-->
          <copy bpelx:ignoreMissingFromData="yes">
            <from variable="outputVariable" part="payload"
                  query="/ns3:QueryReceivedPaymentListResponseEBM/ns3:DataArea/ns3:QueryReceivedPaymentListResponse/ns4:Status"/>
            <to variable="Invoke_UpadatePaymentStatus_execute_InputVariable"
                part="request"
                query="/ns3:CreateReceivedPaymentResponseEBM/ns3:DataArea/ns3:CreateReceivedPaymentResponse/ns4:Status/ns4:Code"/>
          </copy>
        </assign>
        <invoke name="Invoke_UpadatePaymentStatus"
                inputVariable="Invoke_UpadatePaymentStatus_execute_InputVariable"
                partnerLink="UpdatePaymentReceipt" portType="ns15:execute_ptt"
                operation="execute" bpelx:invokeAsDetail="no"/>
      </sequence>
    </scope>
    <!-- Generate reply to synchronous request -->
    <reply name="replyOutput" partnerLink="processpaymentebf_client"
           portType="client:ProcessPaymentEBF" operation="process"
           variable="outputVariable"/>
  </sequence>
</process>
